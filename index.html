<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>线性加速度可视化</title>
</head>

<body>
    <svg id="accel-svg" width="300" height="300">
        <circle cx="150" cy="150" r="100" stroke="black" stroke-width="2" fill="none" />
        <line id="accel-line" x1="150" y1="150" x2="150" y2="150" stroke="red" stroke-width="3" />
    </svg>
</body>

<style>
    body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
    }

    svg {
        border: 1px solid #333;
    }
</style>

<script>
    // 归一化处理
    const MAX_ACCEL = 10; // 假设最大加速度 10 m/s²
    const SVG_CENTER = 150;
    const SVG_RADIUS = 100;

    async function requestPermission() {
        if (typeof DeviceMotionEvent.requestPermission === 'function') {
            try {
                let permission = await DeviceMotionEvent.requestPermission();
                if (permission === 'granted') {
                    startTracking();
                } else {
                    alert("需要允许运动传感器权限才能获取加速度数据");
                }
            } catch (error) {
                console.error("请求加速度权限失败:", error);
            }
        } else {
            startTracking(); // 直接开始（Android 设备通常不需要额外权限）
        }
    }

    function startTracking() {
        window.addEventListener("devicemotion", (event) => {
            let ax = event.acceleration.x || 0;
            let ay = event.acceleration.y || 0;

            // 归一化到SVG坐标
            let normX = Math.max(-MAX_ACCEL, Math.min(MAX_ACCEL, ax)) / MAX_ACCEL;
            let normY = Math.max(-MAX_ACCEL, Math.min(MAX_ACCEL, ay)) / MAX_ACCEL;

            let svgX = SVG_CENTER + normX * SVG_RADIUS;
            let svgY = SVG_CENTER - normY * SVG_RADIUS; // Y轴方向与屏幕相反

            let line = document.getElementById("accel-line");
            line.setAttribute("x2", svgX);
            line.setAttribute("y2", svgY);
        });
    }

    requestPermission();
</script>

</html>